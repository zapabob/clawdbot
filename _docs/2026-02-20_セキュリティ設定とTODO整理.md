# 2026-02-20 セキュリティ設定 & TODO整理

## 概要

`.env` のセキュリティ設定修正と、未設定のAPIキー・起動テストのTODO整理を実施した。

---

## 変更内容

### 1. Discord groupPolicy を allowlist に修正

**ファイル**: `.env`

```diff
+ DISCORD_DM_POLICY=open
+ DISCORD_GROUP_POLICY=allowlist
```

- Discord グループからのメッセージを allowlist ユーザーのみに制限
- LINE 側は既に `LINE_GROUP_POLICY=allowlist` で設定済みだったため変更なし

---

### 2. Gateway トークン更新

**ファイル**: `.env`

```diff
+ # Gateway Access Token (長いランダムトークン - セキュアに変更済み)
+ OPENCLAW_GATEWAY_TOKEN=kUyymC6zOuDa41H0KEcVZILRScO2vJ7Z95cPBX2jF9GAy0BO7y08NKFEgFn22BZ
```

- `py -3 -c "import secrets; print(secrets.token_urlsafe(48))"` で生成した64文字のランダムトークン
- 参照先: `src/gateway/auth.ts` L217 の `OPENCLAW_GATEWAY_TOKEN` 環境変数

---

## 未完了TODOs（手動対応が必要）

| #   | タスク                   | URL                                    | .env キー                  |
| --- | ------------------------ | -------------------------------------- | -------------------------- |
| 1   | Brave Search APIキー取得 | https://brave.com/search/api/          | `BRAVE_API_KEY` (L92)      |
| 2   | Perplexity APIキー取得   | https://www.perplexity.ai/settings/api | `PERPLEXITY_API_KEY` (L96) |
| 3   | Firecrawl APIキー取得    | https://firecrawl.dev                  | `FIRECRAWL_API_KEY` (L100) |
| 4   | SBV2 起動テスト          | `Desktop\SBV2-TTS.lnk`                 | —                          |
| 5   | アバター表示テスト       | `Desktop\HakuaAvatar.lnk`              | —                          |
| 6   | OpenClaw 起動テスト      | `Desktop\OpenClaw.lnk`                 | —                          |

---

## 関連ファイル

- `.env` — 環境変数設定ファイル
- `src/gateway/auth.ts` — Gateway 認証ロジック（`OPENCLAW_GATEWAY_TOKEN` 参照箇所: L217）
