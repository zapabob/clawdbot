# 2026-02-20 自己改善・自己増殖・自己修復システム

## 概要

Clawdbot に自律的な自己改善・自己増殖・自己修復機能を追加した。

## 追加ファイル

### `src/agents/self-metrics.ts` (NEW)

- `MetricsCollector` — LLM呼び出しごとにレイテンシ/成功/タスク完了を記録
- ローリング100件で `~/.openclaw/metrics.json` に永続化
- `captureSystemSnapshot()` — OS レベルのメモリ/CPU/ディスク使用率を取得
- `getSharedMetricsCollector()` — プロセス内シングルトン

### `src/agents/self-replication.ts` (NEW)

- `SelfReplicationEngine` — エージェントをディレクトリごとクローン
- 上限 `MAX_CLONES = 5` でリソース管理
- `spawnClone()` / `pruneWeakClones()` / `promotesBestClone()`
- マニフェスト `~/.openclaw/replication-manifest.json` で追跡

### `src/agents/evo-daemon.ts` (NEW)

- `EvoDaemon` — 自律スケジューラ
  - 修復: 5分ごと
  - 進化: 1時間ごと
  - 増殖チェック: 2時間ごと
- PIDロックファイルでシングルトン保証
- `daemon-status.json` で状態永続化
- `readDaemonStatus()` / `isDaemonRunning()` — CLIから参照可能

## 修正ファイル

### `src/agents/self-evolution.ts` (MODIFIED)

- `evaluateIndividual()` のランダム評価を **実メトリクス駆動** に置き換え
  - 適応度 = 40% タスク完了率 + 30% 正常率 + 20% レスポンス速度 + 10% メモリ余裕
- `evolveWithMetrics(metrics: AgentMetrics)` メソッド追加

### `src/agents/self-repair.ts` (MODIFIED)

- `checkDiskSpace()` — ディスク空き容量チェック (5%以下でcritical)
- `checkNodeProcessMemory()` — heap圧迫・システムメモリチェック

### `src/cli/evo-cli.ts` (MODIFIED)

新コマンド:

- `openclaw evo daemon start [--repair-interval] [--evolve-interval]`
- `openclaw evo daemon status`
- `openclaw evo clone list`
- `openclaw evo clone prune [-k N]`
- `openclaw evo clone spawn`
- `openclaw evo metrics`

## 検証

```
pnpm tsgo → exit code 0 (型エラー0)
```
